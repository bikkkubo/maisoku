# CLAUDE.md — Project Policy for Claude Code (mysoku-renamer)

## 0. 目的
不動産「マイソク」PDFから必要項目（売買/賃貸、物件名、価格/家賃 等）を抽出し、
命名規則に沿って **安全・最小差分**でファイル名を自動リネームする。

## 1. 進め方（厳守：段階的進行）
1) **Specification（仕様）** → 2) **Plan（設計）** → 3) **Tasks（タスク分解）** → 4) **Implementation（実装）**
- 初回は **仕様作成/更新のみ**。コード生成は禁止。
- 各段階は**承認が出るまで次段階に進まない**。

## 2. izANAMI式・暴走抑止の4段階
- **Clarify（解像度上げ）**: 入力/出力/制約/除外/非機能（性能・運用）を質問で確定。推測実装NG。
- **Scope（範囲確定）**: 必要最小に限定。勝手な高機能化、複雑なOCRパイプライン、メトリクス大量導入は禁止。
- **Plan（計画）**: 依存・IF・検証観点を定義し、`TASKS.md`へ小PR粒度で分割。
- **Implement（実装）**: `TASKS.md`該当差分のみ実装。逸脱禁止。

## 3. このプロジェクトの仕様骨子
- 命名規則（初期）
  - **売買**: `【売買】<物件名>_<価格N億円 | 価格N,NNN万円>`
  - **賃貸**: `【賃貸】<物件名>_家賃<金額>円`
- 入力: マイソクPDF（1件または複数一括）
- 抽出候補: 売買/賃貸別、物件名、価格/家賃（数値正規化）、通貨表記ゆれの正規化、全角半角混在の正規化
- 出力: 新ファイル名で保存（上書きしない／衝突時は連番付与）

## 4. 実装上の禁止／許可（必読）
- 禁止:
  - 仕様・設計の合意なく**コード生成**や**依存追加**をしない
  - 勝手にOCR/レイアウト解析の大型依存（例：tesseract/azeroth/torch等）を追加しない
  - 大量ファイルに**一括破壊的処理**をしない（まず1〜3件で検証）
  - ログ/テレメトリを過剰収集しない
- 許可（ただし**都度許可制**）:
  - 依存の提案（最小）→ 目的・比較・アンインストール手順と併記
  - シェル/CLI実行、PDF/画像入出力、バッチ処理
  - データサンプルの作成（匿名ダミー）

## 5. コンテキスト喪失対策（Claude Code特有）
- `/compact` は使わない。必要時は `/reset` を行い、
  **「プロジェクトルートの CLAUDE.md を再読込してから続行」** と明示すること。
- 会話が長くなったら、常に **現行 SPEC / PLAN / TASKS の要約→確認** から再開。

## 6. ドキュメント規約
- 仕様: `docs/specs/*.md`（本件: `mysoku_rename_spec.md`）
- 設計: `docs/plans/*.md`（本件: `mysoku_rename_plan.md`）
- タスク: ルート `TASKS.md`
- 実装PRには**関連SPEC/TASKへのリンク**と**ドキュメント差分**を必須とする。

## 7. 出力モード
- 仕様段階: 仕様の追記/修正のみ。コード断片は必要最小限の例示に留める。
- 設計段階: IF/型/例外/テスト戦略。擬似コードは最小化。外部コマンドは提案に留め、**許可待ち**。
- 実装段階: 変更差分（ファイル/追加削除/テスト）を明記。過剰生成は禁止。

## 8. 受入と検証
- 受入条件（SPECに定義）に沿ったテストのみ実装。
- 一括実行前に**ドライラン**（対象PDF一覧→想定新ファイル名のプレビュー）を必須とする。

